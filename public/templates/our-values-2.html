<svg id="<%= id %>" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round" width="100%">
    <defs>
<%
var letter, length, tabs;
var delay = 0;
var x = 0.4, y = 0;
for (var i=0; i < text.length; i++) {
	letter = text[i];
	if (letter == '/n') {
		y += lineHeight;
		x = 0;
	} else if (letter == '/t') {
		tabs = x % 50;
		x = ++tabs * tabWidth;
	} else {
%>
        <mask id="letter-mask-<%= i %>" x="<%= 20 * i %>" y="0">
<%
		numVectorSets = font[letter].vectors.length;
		font[letter].vectors.forEach(function(vector) { 
%>
			<path fill="none" stroke="white" stroke-width="<%= vector.strokeWidth %>" stroke-linecap="<%= vector.lineCap ? vector.lineCap : 'round' %>" stroke-dashoffset="<%= vector.length %>" stroke-dasharray="<%= vector.length + ',' + vector.length %>" style="<%= 'transition:stroke-dashoffset ' + speed + 'ms ' + delay + 'ms linear' %>" d="<%=  vector.path %>" />
<%
		});
%>
        </mask>
<%
		// one n-th of the total time (speed) for each sub-path
		delay += Math.round(speed / numVectorSets);
		x += font[letter].width;
	}
}
%>

    </defs>
<rect width="100%" height="100%" fill="red" mask="url(#letter-mask-0)" />

<%
for (var i=0; i < text.length; i++) {
%>
    <text x="<%= 20 * i %>" y="114" fill="<%= color %>" mask="wurl(#letter-mask-<%= i %>)" font-size="16" font-family="StanHand" text-anchor="start"><%= text[i] %></text>
<%
}
%>
</svg>